function getStarredQuestions(){const e=localStorage.getItem("starredQuestions");return e?JSON.parse(e):{}}function saveStarredQuestions(e){localStorage.setItem("starredQuestions",JSON.stringify(e))}function loadStarredQuestions(){const e=getStarredQuestions(),t=Object.values(e);updateStarredCount(t.length),0!==t.length?(t.sort((e,t)=>new Date(t.starredAt)-new Date(e.starredAt)),renderStarredResults(t)):showEmptyState()}function renderStarredResults(e){const t=document.getElementById("starredResults"),n=document.getElementById("emptyState");t.innerHTML="",n.style.display="none";const o=document.createElement("ul");o.className="mdc-list mdc-list--two-line",e.forEach(e=>{const t=document.createElement("li");t.className="mdc-list-item question-item";const n=document.createElement("span");n.className="mdc-list-item__ripple",t.appendChild(n);const r=document.createElement("span");r.className="mdc-list-item__text";const a=document.createElement("span");a.className="mdc-list-item__primary-text question-title";const c=document.createElement("span");c.className="question-number",c.textContent=e.originalIndex;const s=document.createElement("span");s.innerHTML=e.question,a.appendChild(c),a.appendChild(s),r.appendChild(a);const d=document.createElement("ul");d.className="options-list mdc-list-item__secondary-text";[...e.options].sort((e,t)=>{const n="true"===e.is_correct,o="true"===t.is_correct;return n&&!o?-1:!n&&o?1:0}).forEach(e=>{const t=document.createElement("li");t.innerHTML=e.option,t.className="true"===e.is_correct?"correct":"incorrect",d.appendChild(t)}),r.appendChild(d);const i=document.createElement("button");i.className="star-btn starred",i.title="取消收藏",i.innerHTML='<span class="material-icons">star</span>',i.addEventListener("click",t=>{t.stopPropagation(),removeFromStarred(e.originalIndex)}),t.appendChild(r),t.appendChild(i),o.appendChild(t)}),t.appendChild(o)}function removeFromStarred(e){const t=getStarredQuestions();delete t[e],saveStarredQuestions(t),loadStarredQuestions()}function updateStarredCount(e){const t=document.getElementById("starredCount");t&&(t.textContent=`${e} 道题目`)}function showEmptyState(){const e=document.getElementById("starredResults"),t=document.getElementById("emptyState");e.innerHTML="",t.style.display="block"}function initializeStarredPageEvents(){const e=document.getElementById("star");e&&e.addEventListener("click",function(){window.location.href="/star/"});const t=document.getElementById("calculatorBtn");t&&t.addEventListener("click",function(){window.location.href="/calc/"});[document.getElementById("backBtn"),document.getElementById("backToHomeBtn")].forEach(e=>{e&&e.addEventListener("click",function(){window.location.href="/"})});const n=document.getElementById("clearAllBtn");n&&n.addEventListener("click",function(){confirm("确定要清空所有收藏的题目吗？此操作不可撤销。")&&(localStorage.removeItem("starredQuestions"),loadStarredQuestions())});const o=document.getElementById("backupBtn");o&&o.addEventListener("click",function(){exportStarredQuestions()});const r=document.getElementById("importBtn"),a=document.getElementById("importFileInput");r&&a&&(r.addEventListener("click",function(){a.click()}),a.addEventListener("change",function(e){const t=e.target.files[0];t&&importStarredQuestions(t)}));const c=document.getElementById("themeToggle"),s=document.getElementById("themeIcon");if(c){const e=localStorage.getItem("theme");if(e)d(e);else{d(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}c.addEventListener("click",function(){d("dark"===document.documentElement.getAttribute("data-theme")?"light":"dark")})}function d(e){document.documentElement.setAttribute("data-theme",e),s&&(s.textContent="dark"===e?"light_mode":"dark_mode"),localStorage.setItem("theme",e)}const i=document.querySelector(".top-bar-left");i&&(i.style.cursor="pointer",i.addEventListener("click",function(){window.location.href="/"}))}function exportStarredQuestions(){const e=getStarredQuestions(),t=Object.keys(e).length;if(0===t)return void alert("没有收藏的题目可以备份");const n={exportTime:(new Date).toISOString(),version:"1.0",count:t,data:e},o=JSON.stringify(n,null,2),r=new Blob([o],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(r),a.download=`starred_questions_${(new Date).toISOString().split("T")[0]}.json`,document.body.appendChild(a),a.click(),document.body.removeChild(a),alert(`备份成功！已导出 ${t} 道收藏的题目`)}function importStarredQuestions(e){const t=new FileReader;t.onload=function(e){try{const t=JSON.parse(e.target.result);if(!t.data||"object"!=typeof t.data)throw new Error("文件格式不正确");const n=getStarredQuestions(),o=new Set(Object.keys(n));let r=0,a=0;Object.keys(t.data).forEach(e=>{o.has(e)?a++:(n[e]=t.data[e],r++)}),saveStarredQuestions(n),loadStarredQuestions(),alert(`导入成功！新增 ${r} 道题目，跳过 ${a} 道重复题目。`)}catch(e){console.error("导入错误:",e),alert("导入失败：文件格式不正确或文件损坏")}document.getElementById("importFileInput").value=""},t.readAsText(e)}document.addEventListener("DOMContentLoaded",function(){loadStarredQuestions(),initializeStarredPageEvents()});