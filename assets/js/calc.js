function initializeCalcPage(){const e=document.getElementById("backBtn");e&&e.addEventListener("click",function(){window.location.href="/"});const t=document.getElementById("star");t&&t.addEventListener("click",function(){window.location.href="/star/"});const n=document.getElementById("calculatorBtn");n&&n.addEventListener("click",function(){window.location.href="/calc/"});const l=document.getElementById("themeToggle"),i=document.getElementById("themeIcon");if(l){const e=localStorage.getItem("theme");if(e)a(e);else{a(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}l.addEventListener("click",function(){a("dark"===document.documentElement.getAttribute("data-theme")?"light":"dark")})}function a(e){document.documentElement.setAttribute("data-theme",e),i&&(i.textContent="dark"===e?"light_mode":"dark_mode"),localStorage.setItem("theme",e)}const c=document.querySelector(".top-bar-left");c&&(c.style.cursor="pointer",c.addEventListener("click",function(){window.location.href="/"}))}function initializeCalculator(){const e=document.getElementById("qualificationTime"),t=document.getElementById("bindTimeAbsolute"),n=document.getElementById("bindTimeRelative"),l=document.getElementById("unlockTimeAbsolute"),i=document.getElementById("unlockTimeRelative"),a=document.getElementById("bindAbsoluteTab"),c=document.getElementById("bindRelativeTab"),o=document.getElementById("unlockAbsoluteTab"),d=document.getElementById("unlockRelativeTab");document.getElementById("bindAbsoluteInput"),document.getElementById("bindRelativeInput"),document.getElementById("unlockAbsoluteInput"),document.getElementById("unlockRelativeInput");a.addEventListener("click",function(){switchMode("bind","absolute")}),c.addEventListener("click",function(){switchMode("bind","relative")}),o.addEventListener("click",function(){switchMode("unlock","absolute")}),d.addEventListener("click",function(){switchMode("unlock","relative")}),e.addEventListener("change",calculateResults),t.addEventListener("change",calculateResults),n.addEventListener("input",calculateResults),l.addEventListener("change",calculateResults),i.addEventListener("input",calculateResults);document.querySelectorAll(".mdc-text-field").forEach(e=>{new mdc.textField.MDCTextField(e)})}function switchMode(e,t){if("bind"===e){const e=document.getElementById("bindAbsoluteTab"),n=document.getElementById("bindRelativeTab"),l=document.getElementById("bindAbsoluteInput"),i=document.getElementById("bindRelativeInput");"absolute"===t?(e.classList.add("active"),n.classList.remove("active"),l.style.display="block",i.style.display="none"):(e.classList.remove("active"),n.classList.add("active"),l.style.display="none",i.style.display="block")}else if("unlock"===e){const e=document.getElementById("unlockAbsoluteTab"),n=document.getElementById("unlockRelativeTab"),l=document.getElementById("unlockAbsoluteInput"),i=document.getElementById("unlockRelativeInput");"absolute"===t?(e.classList.add("active"),n.classList.remove("active"),l.style.display="block",i.style.display="none"):(e.classList.remove("active"),n.classList.add("active"),l.style.display="none",i.style.display="block")}calculateResults()}function calculateResults(){const e=getQualificationTime(),t=getBindTime(),n=getUnlockTime();if(e){displayQualificationResult(new Date(e.getTime()+12096e5))}else hideQualificationResult();if(t){displayBindResult(new Date(t.getTime()+2592e5))}else hideBindResult();e&&t&&n?checkEligibility(e,t,n):hideFinalResult()}function getQualificationTime(){const e=document.getElementById("qualificationTime");return e.value?new Date(e.value):null}function getBindTime(){const e=document.getElementById("bindTimeAbsolute"),t=document.getElementById("bindTimeRelative");if(document.getElementById("bindAbsoluteTab").classList.contains("active"))return e.value?new Date(e.value):null;{const e=getQualificationTime(),n=parseRelativeTime(t.value);return e&&null!==n?new Date(e.getTime()+n):null}}function getUnlockTime(){const e=document.getElementById("unlockTimeAbsolute"),t=document.getElementById("unlockTimeRelative");if(document.getElementById("unlockAbsoluteTab").classList.contains("active"))return e.value?new Date(e.value):null;{const e=getBindTime(),n=parseRelativeTime(t.value);return e&&null!==n?new Date(e.getTime()+n):null}}function displayQualificationResult(e){const t=document.getElementById("qualificationResult");document.getElementById("qualificationExpiry").textContent=formatDateTime(e),t.style.display="block"}function hideQualificationResult(){document.getElementById("qualificationResult").style.display="none"}function displayBindResult(e){const t=document.getElementById("bindResult");document.getElementById("waitingPeriodEnd").textContent=formatDateTime(e),t.style.display="block"}function hideBindResult(){document.getElementById("bindResult").style.display="none"}function checkEligibility(e,t,n){const l=new Date(e.getTime()+12096e5),i=new Date(t.getTime()+2592e5),a=document.getElementById("finalResult"),c=document.getElementById("resultStatus"),o=document.getElementById("resultDetails"),d=document.getElementById("resultCard");let u=!0,s=[];l<i?(u=!1,s.push(`资格过期时间（${formatDateTime(l)}）早于等待期结束时间（${formatDateTime(i)}），无法解锁`)):(n>l&&(u=!1,s.push(`资格已过期（${formatDateTime(l)}）`)),n<i&&(u=!1,s.push(`等待期未结束（需等到 ${formatDateTime(i)}）`))),u?(c.innerHTML='<span class="status-icon success">✓</span> 可以解锁',o.textContent=`您可以在 ${formatDateTime(n)} 成功解锁设备`,d.className="final-result-card success"):(c.innerHTML='<span class="status-icon error">✗</span> 无法解锁',o.innerHTML="存在以下问题：<br>"+s.map(e=>`• ${e}`).join("<br>"),d.className="final-result-card error"),a.style.display="block"}function hideFinalResult(){document.getElementById("finalResult").style.display="none"}function parseRelativeTime(e){if(!e||"string"!=typeof e)return null;let t=0;const n=(e=e.replace(/\s+/g,"")).match(/(\d+)天/);n&&(t+=24*parseInt(n[1])*60*60*1e3);const l=e.match(/(\d+)时/);l&&(t+=60*parseInt(l[1])*60*1e3);const i=e.match(/(\d+)分/);if(i&&(t+=60*parseInt(i[1])*1e3),!n&&!l&&!i){const n=parseFloat(e);isNaN(n)||(t=24*n*60*60*1e3)}return t>0?t:null}function formatDateTime(e){return`${e.getFullYear()}年${String(e.getMonth()+1).padStart(2,"0")}月${String(e.getDate()).padStart(2,"0")}日 ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`}document.addEventListener("DOMContentLoaded",function(){mdc.autoInit(),initializeCalculator(),initializeCalcPage()});